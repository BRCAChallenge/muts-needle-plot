!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.mutsNeedlePlot=t()}}(function(){var t;return function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[a]={exports:{}};t[a][0].call(c.exports,function(e){var r=t[a][1][e];return o(r?r:e)},c,c.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,r){!function(e,n){"function"==typeof t&&t.amd?t(["d3"],n):"object"==typeof r&&r.exports?r.exports=function(t){return t.tip=n(t),t.tip}:e.d3.tip=n(e.d3)}(this,function(t){return function(){function e(t){w=p(t),C=w.createSVGPoint(),document.body.appendChild(v)}function r(){return"n"}function n(){return[0,0]}function o(){return" "}function i(){var t=g();return{top:t.n.y-v.offsetHeight,left:t.n.x-v.offsetWidth/2}}function a(){var t=g();return{top:t.s.y,left:t.s.x-v.offsetWidth/2}}function s(){var t=g();return{top:t.e.y-v.offsetHeight/2,left:t.e.x}}function l(){var t=g();return{top:t.w.y-v.offsetHeight/2,left:t.w.x-v.offsetWidth}}function u(){var t=g();return{top:t.nw.y-v.offsetHeight,left:t.nw.x-v.offsetWidth}}function c(){var t=g();return{top:t.ne.y-v.offsetHeight,left:t.ne.x}}function d(){var t=g();return{top:t.sw.y,left:t.sw.x-v.offsetWidth}}function f(){var t=g();return{top:t.se.y,left:t.e.x}}function h(){var e=t.select(document.createElement("div"));return e.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),e.node()}function p(t){return t=t.node(),"svg"===t.tagName.toLowerCase()?t:t.ownerSVGElement}function g(){for(var e=b||t.event.target;"undefined"==typeof e.getScreenCTM&&"undefined"===e.parentNode;)e=e.parentNode;var r={},n=e.getScreenCTM(),o=e.getBBox(),i=o.width,a=o.height,s=o.x,l=o.y;return C.x=s,C.y=l,r.nw=C.matrixTransform(n),C.x+=i,r.ne=C.matrixTransform(n),C.y+=a,r.se=C.matrixTransform(n),C.x-=i,r.sw=C.matrixTransform(n),C.y-=a/2,r.w=C.matrixTransform(n),C.x+=i,r.e=C.matrixTransform(n),C.x-=i/2,C.y-=a/2,r.n=C.matrixTransform(n),C.y+=a,r.s=C.matrixTransform(n),r}var m=r,y=n,x=o,v=h(),w=null,C=null,b=null;e.show=function(){var r=Array.prototype.slice.call(arguments);r[r.length-1]instanceof SVGElement&&(b=r.pop());var n,o=x.apply(this,r),i=y.apply(this,r),a=m.apply(this,r),s=t.select(v),l=S.length,u=document.documentElement.scrollTop||document.body.scrollTop,c=document.documentElement.scrollLeft||document.body.scrollLeft;for(s.html(o).style({opacity:1,"pointer-events":"all"});l--;)s.classed(S[l],!1);return n=k.get(a).apply(this),s.classed(a,!0).style({top:n.top+i[0]+u+"px",left:n.left+i[1]+c+"px"}),e},e.hide=function(){var r=t.select(v);return r.style({opacity:0,"pointer-events":"none"}),e},e.attr=function(r){if(arguments.length<2&&"string"==typeof r)return t.select(v).attr(r);var n=Array.prototype.slice.call(arguments);return t.selection.prototype.attr.apply(t.select(v),n),e},e.style=function(r){if(arguments.length<2&&"string"==typeof r)return t.select(v).style(r);var n=Array.prototype.slice.call(arguments);return t.selection.prototype.style.apply(t.select(v),n),e},e.direction=function(r){return arguments.length?(m=null==r?r:t.functor(r),e):m},e.offset=function(r){return arguments.length?(y=null==r?r:t.functor(r),e):y},e.html=function(r){return arguments.length?(x=null==r?r:t.functor(r),e):x};var k=t.map({n:i,s:a,e:s,w:l,nw:u,ne:c,sw:d,se:f}),S=k.keys();return e}})},{}],2:[function(t,e){function r(e){if(this.maxCoord=e.maxCoord||-1,this.maxCoord<0)throw new Error("'maxCoord' must be defined initiation config!");if(this.minCoord=e.minCoord||1,mutationData=e.mutationData||-1,this.maxCoord<0)throw new Error("'mutationData' must be defined initiation config!");if(regionData=e.regionData||-1,this.maxCoord<0)throw new Error("'regionData' must be defined initiation config!");var r=document.getElementById(e.targetElement)||e.targetElement||document.body,n=this.width=e.width||r.offsetWidth||1e3,o=this.height=e.height||r.offsetHeight||500;this.colorMap=e.colorMap||{},this.legends=e.legends||{y:"Value",x:"Coordinate"},this.buffer=0;var i=(this.maxCoord,0);i=n>=o?o/8:n/8,this.buffer=i;var a=t("d3-tip");a(d3),this.tip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return"<span>"+t.value+" "+t.category+" at coord. "+t.coordString+"</span>"});var s=d3.select(r).append("svg").attr("width",n).attr("height",o).attr("class","mutneedles");s.call(this.tip);var l=d3.scale.linear().domain([this.minCoord,this.maxCoord]).range([1.5*i,n-i]).nice();this.x=l;var u=d3.scale.linear().domain([1,20]).range([o-1.5*i,i]).nice();this.y=u,this.drawNeedles(s,mutationData,regionData)}r.prototype.drawRegions=function(t,e){function r(t){var e=d3.select(".mutneedles").selectAll().data(["dummy"]).enter().insert("g",":first-child").attr("class","regionsBG").append("rect").attr("x",u(a)).attr("y",l(0)+d).attr("width",u(o)-u(a)).attr("height",10),r=e=d3.select(".mutneedles").selectAll().data(t).enter().append("g").attr("class","regionGroup");r.append("rect").attr("x",function(t){return u(t.start)}).attr("y",l(0)+f).attr("ry","3").attr("rx","3").attr("width",function(t){return u(t.end)-u(t.start)}).attr("height",16).style("fill",function(t){return t.color}).style("stroke",function(t){return d3.rgb(t.color).darker()}),r.append("text").attr("class","regionName").attr("text-anchor","middle").attr("x",function(t){return u(t.start)+(u(t.end)-u(t.start))/2}).attr("y",l(0)+h).attr("dy","0.35em").style("font-size","12px").style("text-decoration","bold").text(function(t){return t.name})}function n(t){regionList=[];for(key in t)regionList.push({name:key,start:getRegionStart(t[key]),end:getRegionEnd(t[key]),color:getRegionColor(key)});return regionList}var o=this.maxCoord,a=this.minCoord,s=(this.buffer,this.colorMap),l=this.y,u=this.x,c=!0;getRegionStart=function(t){return parseInt(t.split("-")[0])},getRegionEnd=function(t){return parseInt(t.split("-")[1])},i=0,regionColors=["yellow","orange","lightgreen"],getRegionColor=function(t){return t in s?s[t]:regionColors[i++%regionColors.length]};var d=0,f=d-3,h=d+20;1!=c&&(h=d+5),"string"==typeof e?d3.json(e,function(t,e){return t?console.debug(t):(regionList=n(e),void r(regionList))}):(regionList=n(e),r(regionList))},r.prototype.drawAxes=function(t){var e=this.y,r=this.x;xAxis=d3.svg.axis().scale(r).orient("bottom"),t.append("svg:g").attr("class","x-axis").attr("transform","translate(0,"+(this.height-this.buffer)+")").call(xAxis),yAxis=d3.svg.axis().scale(e).orient("left"),t.append("svg:g").attr("class","y-axis").attr("transform","translate("+(1.2*this.buffer+-10)+",0)").call(yAxis),t.append("text").attr("class","y-label").attr("text-anchor","middle").attr("transform","translate("+this.buffer/3+","+this.height/2+"), rotate(-90)").text(this.legends.y),t.append("text").attr("class","x-label").attr("text-anchor","middle").attr("transform","translate("+this.width/2+","+(this.height-this.buffer/3)+")").text(this.legends.x)},r.prototype.needleHeadColor=function(t,e){return t in e?this.colors[t]:"steelblue"},r.prototype.drawNeedles=function(t,e,r){function n(t){return coordString=t.coord,numericCoord=formatCoord(t.coord),numericValue=Number(t.value),stickHeight=stackNeedle(numericCoord,numericValue,needlePoint),category=t.category||"",stickHeight+numericValue>highest&&(highest=stickHeight+numericValue,getYAxis().domain([0,highest+2])),numericCoord>0?{category:category,coordString:coordString,coord:numericCoord,value:numericValue,stickHeight:stickHeight,color:getColor(category,colors)}:void console.debug("discarding "+t.coord+" "+t.category)}function o(t){for(key in t)formatted=n(t[key]),void 0!=formatted&&u.push(formatted);return u}function i(e){d3.select(".mutneedles").selectAll().data(e).enter().append("line").attr("y1",function(t){return a(t.stickHeight+t.value)}).attr("y2",function(t){return a(t.stickHeight)}).attr("x1",function(t){return s(t.coord)}).attr("x2",function(t){return s(t.coord)}).attr("class","needle-line");minSize=4,maxSize=10,headSizeScale=d3.scale.log().range([minSize,maxSize]).domain([1,highest/2]),headSize=function(t){return d3.min([d3.max([headSizeScale(t),minSize]),maxSize])};d3.select(".mutneedles").selectAll().data(e).enter().append("circle").attr("cy",function(t){return a(t.stickHeight+t.value)}).attr("cx",function(t){return s(t.coord)}).attr("r",function(t){return headSize(t.value)}).style("fill",function(t){return t.color}).style("stroke",function(t){return d3.rgb(t.color).darker()}).on("mouseover",function(t){d3.select(this).moveToFront(),tip.show(t)}).on("mouseout",tip.hide);d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},void 0!=r&&l.drawRegions(t,r),l.drawAxes(t)}var a=this.y,s=this.x,l=this;getYAxis=function(){return a},formatCoord=function(t){return t.indexOf("-")>-1?(coords=t.split("-"),t=Math.floor((parseInt(coords[0])+parseInt(coords[1]))/2)):t=parseInt(t),t},getColor=this.needleHeadColor,colors=this.colorMap,tip=this.tip,needlePoint={},highest=0,stackNeedle=function(t,e,r){return stickHeight=0,t="p"+String(t),t in r?(stickHeight=r[t],newHeight=stickHeight+e,r[t]=newHeight):r[t]=e,stickHeight};var u=[];"string"==typeof e?d3.json(e,function(t,e){if(t)throw new Error(t);u=o(e),i(u)}):(u=o(e),i(u))},e.exports=r},{"d3-tip":1}],"muts-needle-plot":[function(t,e){e.exports=t("./src/js/MutsNeedlePlot.js")},{"./src/js/MutsNeedlePlot.js":2}]},{},["muts-needle-plot"])("muts-needle-plot")});