!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.mutsNeedlePlot=t()}}(function(){var t;return function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return o(n?n:e)},u,u.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e){var n=t("backbone-events-standalone");n.onAll=function(t,e){return this.on("all",t,e),this},n.oldMixin=n.mixin,n.mixin=function(t){n.oldMixin(t);for(var e=["onAll"],r=0;r<e.length;r++){var o=e[r];t[o]=this[o]}return t},e.exports=n},{"backbone-events-standalone":3}],2:[function(e,n,r){!function(){function e(){return{keys:Object.keys||function(t){if("object"!=typeof t&&"function"!=typeof t||null===t)throw new TypeError("keys() called on a non-object");var e,n=[];for(e in t)t.hasOwnProperty(e)&&(n[n.length]=e);return n},uniqueId:function(t){var e=++u+"";return t?t+e:e},has:function(t,e){return c.call(t,e)},each:function(t,e,n){if(null!=t)if(a&&t.forEach===a)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,o=t.length;o>r;r++)if(e.call(n,t[r],r,t)===s)return}else for(var i in t)if(this.has(t,i)&&e.call(n,t[i],i,t)===s)return},once:function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}}}}var o,i=this,s={},a=Array.prototype.forEach,c=Object.prototype.hasOwnProperty,l=Array.prototype.slice,u=0,d=e();o={on:function(t,e,n){if(!h(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!h(this,"once",t,[e,n])||!e)return this;var r=this,o=d.once(function(){r.off(t,o),e.apply(this,arguments)});return o._callback=e,this.on(t,o,n)},off:function(t,e,n){var r,o,i,s,a,c,l,u;if(!this._events||!h(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(s=t?[t]:d.keys(this._events),a=0,c=s.length;c>a;a++)if(t=s[a],i=this._events[t]){if(this._events[t]=r=[],e||n)for(l=0,u=i.length;u>l;l++)o=i[l],(e&&e!==o.callback&&e!==o.callback._callback||n&&n!==o.context)&&r.push(o);r.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=l.call(arguments,1);if(!h(this,"trigger",t,e))return this;var n=this._events[t],r=this._events.all;return n&&g(n,e),r&&g(r,arguments),this},stopListening:function(t,e,n){var r=this._listeners;if(!r)return this;var o=!e&&!n;"object"==typeof e&&(n=this),t&&((r={})[t._listenerId]=t);for(var i in r)r[i].off(e,n,this),o&&delete this._listeners[i];return this}};var f=/\s+/,h=function(t,e,n,r){if(!n)return!0;if("object"==typeof n){for(var o in n)t[e].apply(t,[o,n[o]].concat(r));return!1}if(f.test(n)){for(var i=n.split(f),s=0,a=i.length;a>s;s++)t[e].apply(t,[i[s]].concat(r));return!1}return!0},g=function(t,e){var n,r=-1,o=t.length,i=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++r<o;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i);return;case 2:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i,s);return;case 3:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i,s,a);return;default:for(;++r<o;)(n=t[r]).callback.apply(n.ctx,e)}},p={listenTo:"on",listenToOnce:"once"};d.each(p,function(t,e){o[e]=function(e,n,r){var o=this._listeners||(this._listeners={}),i=e._listenerId||(e._listenerId=d.uniqueId("l"));return o[i]=e,"object"==typeof n&&(r=this),e[t](n,r,this),this}}),o.bind=o.on,o.unbind=o.off,o.mixin=function(t){var e=["on","once","off","trigger","stopListening","listenTo","listenToOnce","bind","unbind"];return d.each(e,function(e){t[e]=this[e]},this),t},"function"==typeof t?t(function(){return o}):"undefined"!=typeof r?("undefined"!=typeof n&&n.exports&&(r=n.exports=o),r.BackboneEvents=o):i.BackboneEvents=o}(this)},{}],3:[function(t,e){e.exports=t("./backbone-events-standalone")},{"./backbone-events-standalone":2}],4:[function(e,n){!function(e,r){"function"==typeof t&&t.amd?t(["d3"],r):"object"==typeof n&&n.exports?n.exports=function(t){return t.tip=r(t),t.tip}:e.d3.tip=r(e.d3)}(this,function(t){return function(){function e(t){b=g(t),C=b.createSVGPoint(),document.body.appendChild(x)}function n(){return"n"}function r(){return[0,0]}function o(){return" "}function i(){var t=p();return{top:t.n.y-x.offsetHeight,left:t.n.x-x.offsetWidth/2}}function s(){var t=p();return{top:t.s.y,left:t.s.x-x.offsetWidth/2}}function a(){var t=p();return{top:t.e.y-x.offsetHeight/2,left:t.e.x}}function c(){var t=p();return{top:t.w.y-x.offsetHeight/2,left:t.w.x-x.offsetWidth}}function l(){var t=p();return{top:t.nw.y-x.offsetHeight,left:t.nw.x-x.offsetWidth}}function u(){var t=p();return{top:t.ne.y-x.offsetHeight,left:t.ne.x}}function d(){var t=p();return{top:t.sw.y,left:t.sw.x-x.offsetWidth}}function f(){var t=p();return{top:t.se.y,left:t.e.x}}function h(){var e=t.select(document.createElement("div"));return e.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),e.node()}function g(t){return t=t.node(),"svg"===t.tagName.toLowerCase()?t:t.ownerSVGElement}function p(){for(var e=w||t.event.target;"undefined"==typeof e.getScreenCTM&&"undefined"===e.parentNode;)e=e.parentNode;var n={},r=e.getScreenCTM(),o=e.getBBox(),i=o.width,s=o.height,a=o.x,c=o.y;return C.x=a,C.y=c,n.nw=C.matrixTransform(r),C.x+=i,n.ne=C.matrixTransform(r),C.y+=s,n.se=C.matrixTransform(r),C.x-=i,n.sw=C.matrixTransform(r),C.y-=s/2,n.w=C.matrixTransform(r),C.x+=i,n.e=C.matrixTransform(r),C.x-=i/2,C.y-=s/2,n.n=C.matrixTransform(r),C.y+=s,n.s=C.matrixTransform(r),n}var m=n,y=r,v=o,x=h(),b=null,C=null,w=null;e.show=function(){var n=Array.prototype.slice.call(arguments);n[n.length-1]instanceof SVGElement&&(w=n.pop());var r,o=v.apply(this,n),i=y.apply(this,n),s=m.apply(this,n),a=t.select(x),c=S.length,l=document.documentElement.scrollTop||document.body.scrollTop,u=document.documentElement.scrollLeft||document.body.scrollLeft;for(a.html(o).style({opacity:1,"pointer-events":"all"});c--;)a.classed(S[c],!1);return r=k.get(s).apply(this),a.classed(s,!0).style({top:r.top+i[0]+l+"px",left:r.left+i[1]+u+"px"}),e},e.hide=function(){var n=t.select(x);return n.style({opacity:0,"pointer-events":"none"}),e},e.attr=function(n){if(arguments.length<2&&"string"==typeof n)return t.select(x).attr(n);var r=Array.prototype.slice.call(arguments);return t.selection.prototype.attr.apply(t.select(x),r),e},e.style=function(n){if(arguments.length<2&&"string"==typeof n)return t.select(x).style(n);var r=Array.prototype.slice.call(arguments);return t.selection.prototype.style.apply(t.select(x),r),e},e.direction=function(n){return arguments.length?(m=null==n?n:t.functor(n),e):m},e.offset=function(n){return arguments.length?(y=null==n?n:t.functor(n),e):y},e.html=function(n){return arguments.length?(v=null==n?n:t.functor(n),e):v};var k=t.map({n:i,s:s,e:a,w:c,nw:l,ne:u,sw:d,se:f}),S=k.keys();return e}})},{}],5:[function(t,e){function n(e){function n(){var t=g.extent();needleHeads=d3.selectAll(".needle-head"),selectedNeedles=[],categCounts={};for(key in Object.keys(o.totalCategCounts))categCounts[key]=0;needleHeads.classed("selected",function(e){return is_brushed=t[0]<=e.coord&&e.coord<=t[1],is_brushed&&(selectedNeedles.push(e),categCounts[e.category]=(categCounts[e.category]||0)+e.value),is_brushed}),o.trigger("needleSelectionChange",{selected:selectedNeedles,categCounts:categCounts,coords:t})}function r(){get_button=d3.select(".clear-button"),o.trigger("needleSelectionChangeEnd",{selected:selectedNeedles,categCounts:categCounts,coords:g.extent()})}var o=this;if(this.maxCoord=e.maxCoord||-1,this.maxCoord<0)throw new Error("'maxCoord' must be defined initiation config!");if(this.minCoord=e.minCoord||1,mutationData=e.mutationData||-1,this.maxCoord<0)throw new Error("'mutationData' must be defined initiation config!");if(regionData=e.regionData||-1,this.maxCoord<0)throw new Error("'regionData' must be defined initiation config!");this.totalCategCounts={},this.categCounts={},this.selectedNeedles=[];var i=document.getElementById(e.targetElement)||e.targetElement||document.body,s=this.width=e.width||i.offsetWidth||1e3,a=this.height=e.height||i.offsetHeight||500;this.colorMap=e.colorMap||{};var c=Object.keys(this.colorMap).map(function(t){return o.colorMap[t]});this.colorScale=d3.scale.category20().domain(Object.keys(this.colorMap)).range(c.concat(d3.scale.category20().range())),this.legends=e.legends||{y:"Value",x:"Coordinate"},this.svgClasses="mutneedles",this.buffer=0;var l=(this.maxCoord,0);l=s>=a?a/8:s/8,this.buffer=l;var u=t("d3-tip");u(d3),this.tip=d3.tip().attr("class","d3-tip d3-tip-needle").offset([-10,0]).html(function(t){return"<span>"+t.value+" "+t.category+" at coord. "+t.coordString+"</span>"}),this.selectionTip=d3.tip().attr("class","d3-tip d3-tip-selection").offset([100,0]).html(function(t){return"<span> Selected coordinates<br/>"+Math.round(t.left)+" - "+Math.round(t.right)+"</span>"}).direction("n");var d=d3.select(i).append("svg").attr("width",s).attr("height",a).attr("class",this.svgClasses);d.call(this.tip),d.call(this.selectionTip);var f=d3.scale.linear().domain([this.minCoord,this.maxCoord]).range([1.5*l,s-l]).nice();this.x=f;var h=d3.scale.linear().domain([1,20]).range([a-1.5*l,l]).nice();this.y=h;var g=d3.svg.brush().x(f).on("brush",n).on("brushend",r);this.svgClasses+=" brush";var p=d.attr("class",this.svgClasses).call(g).selectAll(".extent").attr("height",a);this.drawNeedles(d,mutationData,regionData),o.on("needleSelectionChange",function(t){o.categCounts=t.categCounts,o.selectedNeedles=t.selected,d.call(verticalLegend)}),o.on("needleSelectionChangeEnd",function(t){o.categCounts=t.categCounts,o.selectedNeedles=t.selected,d.call(verticalLegend)}),o.on("needleSelectionChange",function(t){selection=t.coords,selection[1]-selection[0]>10?o.selectionTip.show({left:selection[0],right:selection[1]},p.node()):o.selectionTip.hide()})}n.prototype.drawLegend=function(t){self=this,mutCategories=[],categoryColors=[],allcategs=Object.keys(self.totalCategCounts),orderedDeclaration=self.colorScale.domain();for(idx in orderedDeclaration)c=orderedDeclaration[idx],allcategs.indexOf(c)>-1&&(mutCategories.push(c),categoryColors.push(self.colorScale(c)));mutsScale=self.colorScale.domain(mutCategories).range(categoryColors);var e=self.x.domain();xplacement=.75*(e[1]-e[0])+(e[1]-e[0]),verticalLegend=d3.svg.legend().labelFormat(function(t){return(self.categCounts[t]||0==self.selectedNeedles.length&&self.totalCategCounts[t]||"")+" "+t}).cellPadding(4).orientation("vertical").units("Mutations").cellWidth(20).cellHeight(12).inputScale(mutsScale).cellStepping(4).place({x:xplacement,y:50}),t.call(verticalLegend)},n.prototype.drawRegions=function(t,e){function n(t){var e=d3.select(".mutneedles").selectAll().data(["dummy"]).enter().insert("g",":first-child").attr("class","regionsBG").append("rect").attr("x",a(i)).attr("y",s(0)+l).attr("width",a(o)-a(i)).attr("height",10),n=e=d3.select(".mutneedles").selectAll().data(t).enter().append("g").attr("class","regionGroup");n.append("rect").attr("x",function(t){return a(t.start)}).attr("y",s(0)+u).attr("ry","3").attr("rx","3").attr("width",function(t){return a(t.end)-a(t.start)}).attr("height",16).style("fill",function(t){return t.color}).style("stroke",function(t){return d3.rgb(t.color).darker()}),n.append("text").attr("class","regionName").attr("text-anchor","middle").attr("x",function(t){return a(t.start)+(a(t.end)-a(t.start))/2}).attr("y",s(0)+d).attr("dy","0.35em").style("font-size","12px").style("text-decoration","bold").text(function(t){return t.name})}function r(t){regionList=[];for(key in t)regionList.push({name:key,start:getRegionStart(t[key]),end:getRegionEnd(t[key]),color:getColor(key)});return regionList}var o=this.maxCoord,i=this.minCoord,s=(this.buffer,this.colorMap,this.y),a=this.x,c=!0;getRegionStart=function(t){return parseInt(t.split("-")[0])},getRegionEnd=function(t){return parseInt(t.split("-")[1])},getColor=this.colorScale;var l=0,u=l-3,d=l+20;1!=c&&(d=l+5),"string"==typeof e?d3.json(e,function(t,e){return t?console.debug(t):(regionList=r(e),void n(regionList))}):(regionList=r(e),n(regionList))},n.prototype.drawAxes=function(t){var e=this.y,n=this.x;xAxis=d3.svg.axis().scale(n).orient("bottom"),t.append("svg:g").attr("class","x-axis").attr("transform","translate(0,"+(this.height-this.buffer)+")").call(xAxis),yAxis=d3.svg.axis().scale(e).orient("left"),t.append("svg:g").attr("class","y-axis").attr("transform","translate("+(1.2*this.buffer+-10)+",0)").call(yAxis),t.append("text").attr("class","y-label").attr("text-anchor","middle").attr("transform","translate("+this.buffer/3+","+this.height/2+"), rotate(-90)").text(this.legends.y),t.append("text").attr("class","x-label").attr("text-anchor","middle").attr("transform","translate("+this.width/2+","+(this.height-this.buffer/3)+")").text(this.legends.x)},n.prototype.drawNeedles=function(t,e,n){function r(t){return coordString=t.coord,numericCoord=formatCoord(t.coord),numericValue=Number(t.value),stickHeight=stackNeedle(numericCoord,numericValue,needlePoint),category=t.category||"other",stickHeight+numericValue>highest&&(highest=stickHeight+numericValue,getYAxis().domain([0,highest+2])),numericCoord>0?(c.totalCategCounts[category]=(c.totalCategCounts[category]||0)+numericValue,{category:category,coordString:coordString,coord:numericCoord,value:numericValue,stickHeight:stickHeight,color:c.colorScale(category)}):void console.debug("discarding "+t.coord+" "+t.category+"("+numericCoord+")")}function o(t){for(key in t)formatted=r(t[key]),void 0!=formatted&&l.push(formatted);return l}function i(e){d3.select(".mutneedles").selectAll().data(e).enter().append("line").attr("y1",function(t){return s(t.stickHeight+t.value)}).attr("y2",function(t){return s(t.stickHeight)}).attr("x1",function(t){return a(t.coord)}).attr("x2",function(t){return a(t.coord)}).attr("class","needle-line");minSize=4,maxSize=10,headSizeScale=d3.scale.log().range([minSize,maxSize]).domain([1,highest/2]),headSize=function(t){return d3.min([d3.max([headSizeScale(t),minSize]),maxSize])};d3.select(".mutneedles").selectAll().data(e).enter().append("circle").attr("cy",function(t){return s(t.stickHeight+t.value)}).attr("cx",function(t){return a(t.coord)}).attr("r",function(t){return headSize(t.value)}).attr("class","needle-head").style("fill",function(t){return t.color}).style("stroke",function(t){return d3.rgb(t.color).darker()}).on("mouseover",function(t){d3.select(this).moveToFront(),tip.show(t)}).on("mouseout",tip.hide);d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},void 0!=n&&c.drawRegions(t,n),c.drawLegend(t),c.drawAxes(t)}var s=this.y,a=this.x,c=this;getYAxis=function(){return s},formatCoord=function(t){return t.indexOf("-")>-1?(coords=t.split("-"),t=Math.floor((parseInt(coords[0])+parseInt(coords[1]))/2),isNaN(t)&&("?"==coords[0]?t=parseInt(coords[1]):"?"==coords[1]&&(t=parseInt(coords[0])))):t=parseInt(t),t},tip=this.tip,needlePoint={},highest=0,stackNeedle=function(t,e,n){return stickHeight=0,t="p"+String(t),t in n?(stickHeight=n[t],newHeight=stickHeight+e,n[t]=newHeight):n[t]=e,stickHeight};var l=[];"string"==typeof e?d3.json(e,function(t,e){if(t)throw new Error(t);l=o(e),i(l)}):(l=o(e),i(l))};var r=t("biojs-events");r.mixin(n.prototype),e.exports=n},{"biojs-events":1,"d3-tip":4}],"muts-needle-plot":[function(t,e){e.exports=t("./src/js/MutsNeedlePlot.js")},{"./src/js/MutsNeedlePlot.js":5}]},{},["muts-needle-plot"])("muts-needle-plot")});